import"../chunks/singletons.c44d92ae.js";import{b as Z,c as X,d as ie}from"../chunks/js.cookie.c4425e19.js";import{s as ne,p as oe,a as R,c as S,i as w,T as re,d as _,o as ae,U as le,l as ee,m as te,n as he,f as O,g as M,h as q,E as K,W as ce,j as C,k as N,G as j,N as ue}from"../chunks/scheduler.a278e30b.js";import{S as fe,i as de,h as pe,b as A,d as D,m as L,a as H,t as B,e as P}from"../chunks/index.bc19f21f.js";import{B as me,M as ge,F as z}from"../chunks/DataCell.49b25c64.js";import{B as ve}from"../chunks/Button.4181d088.js";import"../chunks/Indicator.svelte_svelte_type_style_lang.7922a51a.js";import{S as be}from"../chunks/SimpleTable.05b48a41.js";import{D as _e}from"../chunks/Datatable.7d61f8f1.js";import{p as Y}from"../chunks/index.0132ad10.js";const Te=async({fetch:e,params:t,parent:s})=>{let i=Z+X;console.log(i);const o=e(i+"/svt_api/webhook?scope=get_device&id="+t.id,{headers:{"Content-Type":"application/json"}}),n=e(i+"/svt_api/webhook?scope=get_wifi_logs&id="+t.id,{headers:{"Content-Type":"application/json"}}),[l,r]=await Promise.all([o,n]);let h=null;l.ok&&(h=await l.json(),console.log(h));let u=null;return r.ok&&(u=await r.json(),console.log(u)),{id:t.id,device:h,wifi_time_logs:u}},Xe=Object.freeze(Object.defineProperty({__proto__:null,load:Te},Symbol.toStringTag,{value:"Module"}));var x=e=>typeof e=="function"?e:function(){return e},Ce=typeof self<"u"?self:null,U=typeof window<"u"?window:null,I=Ce||U||I,$e="2.0.0",y={connecting:0,open:1,closing:2,closed:3},ke=1e4,ye=1e3,T={closed:"closed",errored:"errored",joined:"joined",joining:"joining",leaving:"leaving"},E={close:"phx_close",error:"phx_error",join:"phx_join",reply:"phx_reply",leave:"phx_leave"},Q={longpoll:"longpoll",websocket:"websocket"},we={complete:4},F=class{constructor(e,t,s,i){this.channel=e,this.event=t,this.payload=s||function(){return{}},this.receivedResp=null,this.timeout=i,this.timeoutTimer=null,this.recHooks=[],this.sent=!1}resend(e){this.timeout=e,this.reset(),this.send()}send(){this.hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload(),ref:this.ref,join_ref:this.channel.joinRef()}))}receive(e,t){return this.hasReceived(e)&&t(this.receivedResp.response),this.recHooks.push({status:e,callback:t}),this}reset(){this.cancelRefEvent(),this.ref=null,this.refEvent=null,this.receivedResp=null,this.sent=!1}matchReceive({status:e,response:t,_ref:s}){this.recHooks.filter(i=>i.status===e).forEach(i=>i.callback(t))}cancelRefEvent(){this.refEvent&&this.channel.off(this.refEvent)}cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=null}startTimeout(){this.timeoutTimer&&this.cancelTimeout(),this.ref=this.channel.socket.makeRef(),this.refEvent=this.channel.replyEventName(this.ref),this.channel.on(this.refEvent,e=>{this.cancelRefEvent(),this.cancelTimeout(),this.receivedResp=e,this.matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}trigger(e,t){this.channel.trigger(this.refEvent,{status:e,response:t})}},se=class{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=null,this.tries=0}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}},Ee=class{constructor(e,t,s){this.state=T.closed,this.topic=e,this.params=x(t||{}),this.socket=s,this.bindings=[],this.bindingRef=0,this.timeout=this.socket.timeout,this.joinedOnce=!1,this.joinPush=new F(this,E.join,this.params,this.timeout),this.pushBuffer=[],this.stateChangeRefs=[],this.rejoinTimer=new se(()=>{this.socket.isConnected()&&this.rejoin()},this.socket.rejoinAfterMs),this.stateChangeRefs.push(this.socket.onError(()=>this.rejoinTimer.reset())),this.stateChangeRefs.push(this.socket.onOpen(()=>{this.rejoinTimer.reset(),this.isErrored()&&this.rejoin()})),this.joinPush.receive("ok",()=>{this.state=T.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this.joinPush.receive("error",()=>{this.state=T.errored,this.socket.isConnected()&&this.rejoinTimer.scheduleTimeout()}),this.onClose(()=>{this.rejoinTimer.reset(),this.socket.hasLogger()&&this.socket.log("channel",`close ${this.topic} ${this.joinRef()}`),this.state=T.closed,this.socket.remove(this)}),this.onError(i=>{this.socket.hasLogger()&&this.socket.log("channel",`error ${this.topic}`,i),this.isJoining()&&this.joinPush.reset(),this.state=T.errored,this.socket.isConnected()&&this.rejoinTimer.scheduleTimeout()}),this.joinPush.receive("timeout",()=>{this.socket.hasLogger()&&this.socket.log("channel",`timeout ${this.topic} (${this.joinRef()})`,this.joinPush.timeout),new F(this,E.leave,x({}),this.timeout).send(),this.state=T.errored,this.joinPush.reset(),this.socket.isConnected()&&this.rejoinTimer.scheduleTimeout()}),this.on(E.reply,(i,o)=>{this.trigger(this.replyEventName(o),i)})}join(e=this.timeout){if(this.joinedOnce)throw new Error("tried to join multiple times. 'join' can only be called a single time per channel instance");return this.timeout=e,this.joinedOnce=!0,this.rejoin(),this.joinPush}onClose(e){this.on(E.close,e)}onError(e){return this.on(E.error,t=>e(t))}on(e,t){let s=this.bindingRef++;return this.bindings.push({event:e,ref:s,callback:t}),s}off(e,t){this.bindings=this.bindings.filter(s=>!(s.event===e&&(typeof t>"u"||t===s.ref)))}canPush(){return this.socket.isConnected()&&this.isJoined()}push(e,t,s=this.timeout){if(t=t||{},!this.joinedOnce)throw new Error(`tried to push '${e}' to '${this.topic}' before joining. Use channel.join() before pushing events`);let i=new F(this,e,function(){return t},s);return this.canPush()?i.send():(i.startTimeout(),this.pushBuffer.push(i)),i}leave(e=this.timeout){this.rejoinTimer.reset(),this.joinPush.cancelTimeout(),this.state=T.leaving;let t=()=>{this.socket.hasLogger()&&this.socket.log("channel",`leave ${this.topic}`),this.trigger(E.close,"leave")},s=new F(this,E.leave,x({}),e);return s.receive("ok",()=>t()).receive("timeout",()=>t()),s.send(),this.canPush()||s.trigger("ok",{}),s}onMessage(e,t,s){return t}isMember(e,t,s,i){return this.topic!==e?!1:i&&i!==this.joinRef()?(this.socket.hasLogger()&&this.socket.log("channel","dropping outdated message",{topic:e,event:t,payload:s,joinRef:i}),!1):!0}joinRef(){return this.joinPush.ref}rejoin(e=this.timeout){this.isLeaving()||(this.socket.leaveOpenTopic(this.topic),this.state=T.joining,this.joinPush.resend(e))}trigger(e,t,s,i){let o=this.onMessage(e,t,s,i);if(t&&!o)throw new Error("channel onMessage callbacks must return the payload, modified or unmodified");let n=this.bindings.filter(l=>l.event===e);for(let l=0;l<n.length;l++)n[l].callback(o,s,i||this.joinRef())}replyEventName(e){return`chan_reply_${e}`}isClosed(){return this.state===T.closed}isErrored(){return this.state===T.errored}isJoined(){return this.state===T.joined}isJoining(){return this.state===T.joining}isLeaving(){return this.state===T.leaving}},G=class{static request(e,t,s,i,o,n,l){if(I.XDomainRequest){let r=new I.XDomainRequest;return this.xdomainRequest(r,e,t,i,o,n,l)}else{let r=new I.XMLHttpRequest;return this.xhrRequest(r,e,t,s,i,o,n,l)}}static xdomainRequest(e,t,s,i,o,n,l){return e.timeout=o,e.open(t,s),e.onload=()=>{let r=this.parseJSON(e.responseText);l&&l(r)},n&&(e.ontimeout=n),e.onprogress=()=>{},e.send(i),e}static xhrRequest(e,t,s,i,o,n,l,r){return e.open(t,s,!0),e.timeout=n,e.setRequestHeader("Content-Type",i),e.onerror=()=>r&&r(null),e.onreadystatechange=()=>{if(e.readyState===we.complete&&r){let h=this.parseJSON(e.responseText);r(h)}},l&&(e.ontimeout=l),e.send(o),e}static parseJSON(e){if(!e||e==="")return null;try{return JSON.parse(e)}catch{return console&&console.log("failed to parse JSON response",e),null}}static serialize(e,t){let s=[];for(var i in e){if(!Object.prototype.hasOwnProperty.call(e,i))continue;let o=t?`${t}[${i}]`:i,n=e[i];typeof n=="object"?s.push(this.serialize(n,o)):s.push(encodeURIComponent(o)+"="+encodeURIComponent(n))}return s.join("&")}static appendParams(e,t){if(Object.keys(t).length===0)return e;let s=e.match(/\?/)?"&":"?";return`${e}${s}${this.serialize(t)}`}},je=e=>{let t="",s=new Uint8Array(e),i=s.byteLength;for(let o=0;o<i;o++)t+=String.fromCharCode(s[o]);return btoa(t)},V=class{constructor(e){this.endPoint=null,this.token=null,this.skipHeartbeat=!0,this.reqs=new Set,this.awaitingBatchAck=!1,this.currentBatch=null,this.currentBatchTimer=null,this.batchBuffer=[],this.onopen=function(){},this.onerror=function(){},this.onmessage=function(){},this.onclose=function(){},this.pollEndpoint=this.normalizeEndpoint(e),this.readyState=y.connecting,this.poll()}normalizeEndpoint(e){return e.replace("ws://","http://").replace("wss://","https://").replace(new RegExp("(.*)/"+Q.websocket),"$1/"+Q.longpoll)}endpointURL(){return G.appendParams(this.pollEndpoint,{token:this.token})}closeAndRetry(e,t,s){this.close(e,t,s),this.readyState=y.connecting}ontimeout(){this.onerror("timeout"),this.closeAndRetry(1005,"timeout",!1)}isActive(){return this.readyState===y.open||this.readyState===y.connecting}poll(){this.ajax("GET","application/json",null,()=>this.ontimeout(),e=>{if(e){var{status:t,token:s,messages:i}=e;this.token=s}else t=0;switch(t){case 200:i.forEach(o=>{setTimeout(()=>this.onmessage({data:o}),0)}),this.poll();break;case 204:this.poll();break;case 410:this.readyState=y.open,this.onopen({}),this.poll();break;case 403:this.onerror(403),this.close(1008,"forbidden",!1);break;case 0:case 500:this.onerror(500),this.closeAndRetry(1011,"internal server error",500);break;default:throw new Error(`unhandled poll status ${t}`)}})}send(e){typeof e!="string"&&(e=je(e)),this.currentBatch?this.currentBatch.push(e):this.awaitingBatchAck?this.batchBuffer.push(e):(this.currentBatch=[e],this.currentBatchTimer=setTimeout(()=>{this.batchSend(this.currentBatch),this.currentBatch=null},0))}batchSend(e){this.awaitingBatchAck=!0,this.ajax("POST","application/x-ndjson",e.join(`
`),()=>this.onerror("timeout"),t=>{this.awaitingBatchAck=!1,!t||t.status!==200?(this.onerror(t&&t.status),this.closeAndRetry(1011,"internal server error",!1)):this.batchBuffer.length>0&&(this.batchSend(this.batchBuffer),this.batchBuffer=[])})}close(e,t,s){for(let o of this.reqs)o.abort();this.readyState=y.closed;let i=Object.assign({code:1e3,reason:void 0,wasClean:!0},{code:e,reason:t,wasClean:s});this.batchBuffer=[],clearTimeout(this.currentBatchTimer),this.currentBatchTimer=null,typeof CloseEvent<"u"?this.onclose(new CloseEvent("close",i)):this.onclose(i)}ajax(e,t,s,i,o){let n,l=()=>{this.reqs.delete(n),i()};n=G.request(e,this.endpointURL(),t,s,this.timeout,l,r=>{this.reqs.delete(n),this.isActive()&&o(r)}),this.reqs.add(n)}},J={HEADER_LENGTH:1,META_LENGTH:4,KINDS:{push:0,reply:1,broadcast:2},encode(e,t){if(e.payload.constructor===ArrayBuffer)return t(this.binaryEncode(e));{let s=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(s))}},decode(e,t){if(e.constructor===ArrayBuffer)return t(this.binaryDecode(e));{let[s,i,o,n,l]=JSON.parse(e);return t({join_ref:s,ref:i,topic:o,event:n,payload:l})}},binaryEncode(e){let{join_ref:t,ref:s,event:i,topic:o,payload:n}=e,l=this.META_LENGTH+t.length+s.length+o.length+i.length,r=new ArrayBuffer(this.HEADER_LENGTH+l),h=new DataView(r),u=0;h.setUint8(u++,this.KINDS.push),h.setUint8(u++,t.length),h.setUint8(u++,s.length),h.setUint8(u++,o.length),h.setUint8(u++,i.length),Array.from(t,d=>h.setUint8(u++,d.charCodeAt(0))),Array.from(s,d=>h.setUint8(u++,d.charCodeAt(0))),Array.from(o,d=>h.setUint8(u++,d.charCodeAt(0))),Array.from(i,d=>h.setUint8(u++,d.charCodeAt(0)));var p=new Uint8Array(r.byteLength+n.byteLength);return p.set(new Uint8Array(r),0),p.set(new Uint8Array(n),r.byteLength),p.buffer},binaryDecode(e){let t=new DataView(e),s=t.getUint8(0),i=new TextDecoder;switch(s){case this.KINDS.push:return this.decodePush(e,t,i);case this.KINDS.reply:return this.decodeReply(e,t,i);case this.KINDS.broadcast:return this.decodeBroadcast(e,t,i)}},decodePush(e,t,s){let i=t.getUint8(1),o=t.getUint8(2),n=t.getUint8(3),l=this.HEADER_LENGTH+this.META_LENGTH-1,r=s.decode(e.slice(l,l+i));l=l+i;let h=s.decode(e.slice(l,l+o));l=l+o;let u=s.decode(e.slice(l,l+n));l=l+n;let p=e.slice(l,e.byteLength);return{join_ref:r,ref:null,topic:h,event:u,payload:p}},decodeReply(e,t,s){let i=t.getUint8(1),o=t.getUint8(2),n=t.getUint8(3),l=t.getUint8(4),r=this.HEADER_LENGTH+this.META_LENGTH,h=s.decode(e.slice(r,r+i));r=r+i;let u=s.decode(e.slice(r,r+o));r=r+o;let p=s.decode(e.slice(r,r+n));r=r+n;let d=s.decode(e.slice(r,r+l));r=r+l;let v=e.slice(r,e.byteLength),g={status:d,response:v};return{join_ref:h,ref:u,topic:p,event:E.reply,payload:g}},decodeBroadcast(e,t,s){let i=t.getUint8(1),o=t.getUint8(2),n=this.HEADER_LENGTH+2,l=s.decode(e.slice(n,n+i));n=n+i;let r=s.decode(e.slice(n,n+o));n=n+o;let h=e.slice(n,e.byteLength);return{join_ref:null,ref:null,topic:l,event:r,payload:h}}},Re=class{constructor(e,t={}){this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.channels=[],this.sendBuffer=[],this.ref=0,this.timeout=t.timeout||ke,this.transport=t.transport||I.WebSocket||V,this.establishedConnections=0,this.defaultEncoder=J.encode.bind(J),this.defaultDecoder=J.decode.bind(J),this.closeWasClean=!1,this.binaryType=t.binaryType||"arraybuffer",this.connectClock=1,this.transport!==V?(this.encode=t.encode||this.defaultEncoder,this.decode=t.decode||this.defaultDecoder):(this.encode=this.defaultEncoder,this.decode=this.defaultDecoder);let s=null;U&&U.addEventListener&&(U.addEventListener("pagehide",i=>{this.conn&&(this.disconnect(),s=this.connectClock)}),U.addEventListener("pageshow",i=>{s===this.connectClock&&(s=null,this.connect())})),this.heartbeatIntervalMs=t.heartbeatIntervalMs||3e4,this.rejoinAfterMs=i=>t.rejoinAfterMs?t.rejoinAfterMs(i):[1e3,2e3,5e3][i-1]||1e4,this.reconnectAfterMs=i=>t.reconnectAfterMs?t.reconnectAfterMs(i):[10,50,100,150,200,250,500,1e3,2e3][i-1]||5e3,this.logger=t.logger||null,this.longpollerTimeout=t.longpollerTimeout||2e4,this.params=x(t.params||{}),this.endPoint=`${e}/${Q.websocket}`,this.vsn=t.vsn||$e,this.heartbeatTimeoutTimer=null,this.heartbeatTimer=null,this.pendingHeartbeatRef=null,this.reconnectTimer=new se(()=>{this.teardown(()=>this.connect())},this.reconnectAfterMs)}getLongPollTransport(){return V}replaceTransport(e){this.connectClock++,this.closeWasClean=!0,this.reconnectTimer.reset(),this.sendBuffer=[],this.conn&&(this.conn.close(),this.conn=null),this.transport=e}protocol(){return location.protocol.match(/^https/)?"wss":"ws"}endPointURL(){let e=G.appendParams(G.appendParams(this.endPoint,this.params()),{vsn:this.vsn});return e.charAt(0)!=="/"?e:e.charAt(1)==="/"?`${this.protocol()}:${e}`:`${this.protocol()}://${location.host}${e}`}disconnect(e,t,s){this.connectClock++,this.closeWasClean=!0,this.reconnectTimer.reset(),this.teardown(e,t,s)}connect(e){e&&(console&&console.log("passing params to connect is deprecated. Instead pass :params to the Socket constructor"),this.params=x(e)),!this.conn&&(this.connectClock++,this.closeWasClean=!1,this.conn=new this.transport(this.endPointURL()),this.conn.binaryType=this.binaryType,this.conn.timeout=this.longpollerTimeout,this.conn.onopen=()=>this.onConnOpen(),this.conn.onerror=t=>this.onConnError(t),this.conn.onmessage=t=>this.onConnMessage(t),this.conn.onclose=t=>this.onConnClose(t))}log(e,t,s){this.logger(e,t,s)}hasLogger(){return this.logger!==null}onOpen(e){let t=this.makeRef();return this.stateChangeCallbacks.open.push([t,e]),t}onClose(e){let t=this.makeRef();return this.stateChangeCallbacks.close.push([t,e]),t}onError(e){let t=this.makeRef();return this.stateChangeCallbacks.error.push([t,e]),t}onMessage(e){let t=this.makeRef();return this.stateChangeCallbacks.message.push([t,e]),t}ping(e){if(!this.isConnected())return!1;let t=this.makeRef(),s=Date.now();this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:t});let i=this.onMessage(o=>{o.ref===t&&(this.off([i]),e(Date.now()-s))});return!0}clearHeartbeats(){clearTimeout(this.heartbeatTimer),clearTimeout(this.heartbeatTimeoutTimer)}onConnOpen(){this.hasLogger()&&this.log("transport",`connected to ${this.endPointURL()}`),this.closeWasClean=!1,this.establishedConnections++,this.flushSendBuffer(),this.reconnectTimer.reset(),this.resetHeartbeat(),this.stateChangeCallbacks.open.forEach(([,e])=>e())}heartbeatTimeout(){this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null,this.hasLogger()&&this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.triggerChanError(),this.closeWasClean=!1,this.teardown(()=>this.reconnectTimer.scheduleTimeout(),ye,"heartbeat timeout"))}resetHeartbeat(){this.conn&&this.conn.skipHeartbeat||(this.pendingHeartbeatRef=null,this.clearHeartbeats(),this.heartbeatTimer=setTimeout(()=>this.sendHeartbeat(),this.heartbeatIntervalMs))}teardown(e,t,s){if(!this.conn)return e&&e();this.waitForBufferDone(()=>{this.conn&&(t?this.conn.close(t,s||""):this.conn.close()),this.waitForSocketClosed(()=>{this.conn&&(this.conn.onopen=function(){},this.conn.onerror=function(){},this.conn.onmessage=function(){},this.conn.onclose=function(){},this.conn=null),e&&e()})})}waitForBufferDone(e,t=1){if(t===5||!this.conn||!this.conn.bufferedAmount){e();return}setTimeout(()=>{this.waitForBufferDone(e,t+1)},150*t)}waitForSocketClosed(e,t=1){if(t===5||!this.conn||this.conn.readyState===y.closed){e();return}setTimeout(()=>{this.waitForSocketClosed(e,t+1)},150*t)}onConnClose(e){let t=e&&e.code;this.hasLogger()&&this.log("transport","close",e),this.triggerChanError(),this.clearHeartbeats(),!this.closeWasClean&&t!==1e3&&this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(([,s])=>s(e))}onConnError(e){this.hasLogger()&&this.log("transport",e);let t=this.transport,s=this.establishedConnections;this.stateChangeCallbacks.error.forEach(([,i])=>{i(e,t,s)}),(t===this.transport||s>0)&&this.triggerChanError()}triggerChanError(){this.channels.forEach(e=>{e.isErrored()||e.isLeaving()||e.isClosed()||e.trigger(E.error)})}connectionState(){switch(this.conn&&this.conn.readyState){case y.connecting:return"connecting";case y.open:return"open";case y.closing:return"closing";default:return"closed"}}isConnected(){return this.connectionState()==="open"}remove(e){this.off(e.stateChangeRefs),this.channels=this.channels.filter(t=>t.joinRef()!==e.joinRef())}off(e){for(let t in this.stateChangeCallbacks)this.stateChangeCallbacks[t]=this.stateChangeCallbacks[t].filter(([s])=>e.indexOf(s)===-1)}channel(e,t={}){let s=new Ee(e,t,this);return this.channels.push(s),s}push(e){if(this.hasLogger()){let{topic:t,event:s,payload:i,ref:o,join_ref:n}=e;this.log("push",`${t} ${s} (${n}, ${o})`,i)}this.isConnected()?this.encode(e,t=>this.conn.send(t)):this.sendBuffer.push(()=>this.encode(e,t=>this.conn.send(t)))}makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}sendHeartbeat(){this.pendingHeartbeatRef&&!this.isConnected()||(this.pendingHeartbeatRef=this.makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatTimeoutTimer=setTimeout(()=>this.heartbeatTimeout(),this.heartbeatIntervalMs))}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}onConnMessage(e){this.decode(e.data,t=>{let{topic:s,event:i,payload:o,ref:n,join_ref:l}=t;n&&n===this.pendingHeartbeatRef&&(this.clearHeartbeats(),this.pendingHeartbeatRef=null,this.heartbeatTimer=setTimeout(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)),this.hasLogger()&&this.log("receive",`${o.status||""} ${s} ${i} ${n&&"("+n+")"||""}`,o);for(let r=0;r<this.channels.length;r++){const h=this.channels[r];h.isMember(s,i,o,l)&&h.trigger(i,o,n,l)}for(let r=0;r<this.stateChangeCallbacks.message.length;r++){let[,h]=this.stateChangeCallbacks.message[r];h(t)}})}leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s.isJoined()||s.isJoining()));t&&(this.hasLogger()&&this.log("transport",`leaving duplicate topic "${e}"`),t.leave())}};function Se(e){let t=e[3]?"Online":"...",s;return{c(){s=ee(t)},l(i){s=te(i,t)},m(i,o){w(i,s,o)},p(i,o){o&8&&t!==(t=i[3]?"Online":"...")&&he(s,t)},d(i){i&&_(s)}}}function Ae(e){let t,s,i="Confirmation",o,n,l="Are you sure to send these custom command?",r,h,u,p,d,v,g,m;return u=new z({props:{module:"DeviceAction",key:{label:"delay",expose:!0},data:e[1],input:W()}}),d=new z({props:{module:"DeviceAction",key:{label:"value",expose:!0},data:e[1],input:W()}}),v=new z({props:{module:"DeviceAction",key:{label:"hexData",expose:!0},data:e[1],input:W()}}),g=new z({props:{module:"DeviceAction",key:{label:"format",expose:!0},data:e[1],input:W()}}),{c(){t=O("form"),s=O("h3"),s.textContent=i,o=R(),n=O("p"),n.textContent=l,r=R(),h=O("div"),A(u.$$.fragment),p=R(),A(d.$$.fragment),A(v.$$.fragment),A(g.$$.fragment),this.h()},l(f){t=M(f,"FORM",{class:!0,id:!0,action:!0});var a=q(t);s=M(a,"H3",{class:!0,"data-svelte-h":!0}),K(s)!=="svelte-17fgs5"&&(s.textContent=i),o=S(a),n=M(a,"P",{class:!0,"data-svelte-h":!0}),K(n)!=="svelte-pdc0hi"&&(n.textContent=l),r=S(a),h=M(a,"DIV",{class:!0,role:!0,"aria-labelledby":!0});var c=q(h);D(u.$$.fragment,c),p=S(c),D(d.$$.fragment,c),D(v.$$.fragment,c),D(g.$$.fragment,c),c.forEach(_),a.forEach(_),this.h()},h(){C(s,"class","mb-4 text-xl font-medium text-gray-900 dark:text-white"),C(n,"class",""),C(h,"class","p-4 bg-gray-50 rounded-lg dark:bg-gray-800 mt-4"),C(h,"role","tabpanel"),C(h,"aria-labelledby","id-tab"),C(t,"class","flex flex-col space-y-6"),C(t,"id","currentForm"),C(t,"action","#")},m(f,a){w(f,t,a),j(t,s),j(t,o),j(t,n),j(t,r),j(t,h),L(u,h,null),j(h,p),L(d,h,null),L(v,h,null),L(g,h,null),m=!0},p(f,a){const c={};a&2&&(c.data=f[1]),u.$set(c);const b={};a&2&&(b.data=f[1]),d.$set(b);const k={};a&2&&(k.data=f[1]),v.$set(k);const $={};a&2&&($.data=f[1]),g.$set($)},i(f){m||(H(u.$$.fragment,f),H(d.$$.fragment,f),H(v.$$.fragment,f),H(g.$$.fragment,f),m=!0)},o(f){B(u.$$.fragment,f),B(d.$$.fragment,f),B(v.$$.fragment,f),B(g.$$.fragment,f),m=!1},d(f){f&&_(t),P(u),P(d),P(v),P(g)}}}function De(e){let t;return{c(){t=ee("Submit")},l(s){t=te(s,"Submit")},m(s,i){w(s,t,i)},d(s){s&&_(t)}}}function Le(e){let t,s;return t=new ve({props:{$$slots:{default:[De]},$$scope:{ctx:e}}}),t.$on("click",e[8]),{c(){A(t.$$.fragment)},l(i){D(t.$$.fragment,i)},m(i,o){L(t,i,o),s=!0},p(i,o){const n={};o&16384&&(n.$$scope={dirty:o,ctx:i}),t.$set(n)},i(i){s||(H(t.$$.fragment,i),s=!0)},o(i){B(t.$$.fragment,i),s=!1},d(i){P(t,i)}}}function He(e){let t,s,i='<h2 class="font-bold">DuitNow Static QR</h2> <p>Print out this QRcode</p>',o,n,l;return{c(){t=O("div"),s=O("div"),s.innerHTML=i,o=R(),n=O("img"),this.h()},l(r){t=M(r,"DIV",{class:!0});var h=q(t);s=M(h,"DIV",{"data-svelte-h":!0}),K(s)!=="svelte-13ologc"&&(s.innerHTML=i),o=S(h),n=M(h,"IMG",{src:!0,style:!0}),h.forEach(_),this.h()},h(){ce(n.src,l="https://api.qrserver.com/v1/create-qr-code/?size=150x150&color=ec2f66&data="+e[4].qr_code_data)||C(n,"src",l),N(n,"display","block"),N(n,"-webkit-user-select","none"),N(n,"margin","auto"),N(n,"background-color","hsl(0, 0%, 90%)"),N(n,"transition","background-color 300ms"),C(t,"class","p-20 flex justify-center flex-col items-center gap-3")},m(r,h){w(r,t,h),j(t,s),j(t,o),j(t,n)},p:ue,d(r){r&&_(t)}}}function Be(e){let t;return{c(){t=O("div"),this.h()},l(s){t=M(s,"DIV",{id:!0,style:!0,class:!0}),q(t).forEach(_),this.h()},h(){C(t,"id","chartContainer"),N(t,"width","80vw"),N(t,"height","50vh"),C(t,"class","p-4 svelte-1qh3btm")},m(s,i){w(s,t,i)},d(s){s&&_(t)}}}function Pe(e){let t,s,i,o,n,l,r,h,u,p,d;t=new me({props:{style:"position: absolute; right: 10vw;",class:"text-large",large:"true",color:e[3]?"green":"yellow",$$slots:{default:[Se]},$$scope:{ctx:e}}});function v(a){e[9](a)}let g={size:"lg",autoclose:!1,class:"w-full",outsideclose:!0,$$slots:{footer:[Le],default:[Ae]},$$scope:{ctx:e}};e[2]!==void 0&&(g.open=e[2]),i=new ge({props:g}),oe.push(()=>pe(i,"open",v)),l=new be({props:{title:"Device - "+e[4].name,description:"Manual control device with following commands",data:{apiData:{id:e[0].id},buttons:[{name:"Control",onclickFn:e[6]},{name:"Custom",onclickFn:e[5]}],scope:"get_device_commands",columns:[{label:"Name",data:"name"}]}}});let m=e[4].qr_code_data&&He(e),f=e[4].is_cloridge==!1&&Be();return p=new _e({props:{data:{appendQueries:{device_id:e[4].id},inputs:[],search_queries:["a.uuid"],model:"DeviceLog",preloads:[],buttons:[],customCols:[{title:"General",list:["id","name",{label:"is_active",boolean:!0}]}],columns:[{label:"ID",data:"id"},{label:"Remarks",data:"remarks"},{label:"Ref",data:"uuid"},{label:"Timestamp",data:"inserted_at",formatDateTime:!0,offset:8}]}}}),{c(){A(t.$$.fragment),s=R(),A(i.$$.fragment),n=R(),A(l.$$.fragment),r=R(),m&&m.c(),h=R(),f&&f.c(),u=R(),A(p.$$.fragment)},l(a){D(t.$$.fragment,a),s=S(a),D(i.$$.fragment,a),n=S(a),D(l.$$.fragment,a),r=S(a),m&&m.l(a),h=S(a),f&&f.l(a),u=S(a),D(p.$$.fragment,a)},m(a,c){L(t,a,c),w(a,s,c),L(i,a,c),w(a,n,c),L(l,a,c),w(a,r,c),m&&m.m(a,c),w(a,h,c),f&&f.m(a,c),w(a,u,c),L(p,a,c),d=!0},p(a,[c]){const b={};c&8&&(b.color=a[3]?"green":"yellow"),c&16392&&(b.$$scope={dirty:c,ctx:a}),t.$set(b);const k={};c&16386&&(k.$$scope={dirty:c,ctx:a}),!o&&c&4&&(o=!0,k.open=a[2],re(()=>o=!1)),i.$set(k);const $={};c&1&&($.data={apiData:{id:a[0].id},buttons:[{name:"Control",onclickFn:a[6]},{name:"Custom",onclickFn:a[5]}],scope:"get_device_commands",columns:[{label:"Name",data:"name"}]}),l.$set($),a[4].qr_code_data&&m.p(a,c)},i(a){d||(H(t.$$.fragment,a),H(i.$$.fragment,a),H(l.$$.fragment,a),H(p.$$.fragment,a),d=!0)},o(a){B(t.$$.fragment,a),B(i.$$.fragment,a),B(l.$$.fragment,a),B(p.$$.fragment,a),d=!1},d(a){a&&(_(s),_(n),_(r),_(h),_(u)),P(t,a),P(i,a),P(l,a),m&&m.d(a),f&&f.d(a),P(p,a)}}}function Oe(e){return e.map(t=>{const s=new Date(t[0]);return s.setTime(s.getTime()+8*60*60*1e3),{x:s,y:1,z:t[1]}})}function W(e){return null}function Me(e,t,s){var i=Z+X;let{data:o}=t,n=o.device,l,r,h={delay:.1,value:1,format:"pwm",hexData:""},u=!1;console.info(n);let p=!1;const d=c=>{s(3,p=c)};ae(()=>{const c=new Re(ie+X+"/socket");console.info(c),c.connect();var b="user:"+n.name;l=c.channel(b,{}),l.join().receive("ok",$=>{console.log("Joined topic",b)}).receive("error",$=>{console.log("Unable to join topic",b)}),l.on("i_am_online",$=>{console.info($),d(!0)}),setInterval(()=>{console.log("set offline"),s(3,p=!1)},11e3);const k=Oe(o.wifi_time_logs);n.is_cloridge==!1&&new JSC.Chart("chartContainer",{type:"heatmap",series:[{points:k}],xAxis:{label_text:"Time",defaultTick_label_text:$=>new Date($).toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!1})},yAxis:{label_text:"Wifi Online/5 sec Count"},title_label_text:"Wifi Online Heatmap"})}),le(()=>{l.leave()});function v(c,b){console.log("do mar"),console.log(c),s(1,h=c),r=b,s(2,u=!0)}function g(c,b,k){console.log(c),console.log("transfer approved!"),k(!0,"Are you sure to send this command?",()=>{Y({scope:"start_pwm",format:c.format,id:c.id,name:n.name,item_name:c.name,value:c.value,action:c.action,delay:c.delay},{endpoint:i+"/svt_api/webhook",successCallback:()=>{b()}})})}function m(){Y({scope:"start_pwm",id:h.id,name:n.name,format:h.format,item_name:"Send "+h.value+" reps (shorter "+h.delay+")",value:parseInt(h.value),action:h.action,hexData:h.hexData,delay:parseFloat(h.delay)},{endpoint:i+"/svt_api/webhook",successCallback:()=>{r(),s(2,u=!1)}})}const f=()=>m();function a(c){u=c,s(2,u)}return e.$$set=c=>{"data"in c&&s(0,o=c.data)},[o,h,u,p,n,v,g,m,f,a]}class Ke extends fe{constructor(t){super(),de(this,t,Me,Pe,ne,{data:0})}}export{Ke as component,Xe as universal};
