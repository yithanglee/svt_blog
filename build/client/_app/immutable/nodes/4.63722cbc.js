import{P as ae}from"../chunks/constants.387862d7.js";import{s as ue,w as Q,r as oe,x as se,y,f as R,g as A,F as le,i as v,H as b,d as g,Q as Ce,a as T,c as D,h as K,G as X,o as Se,W as Ee,l as N,m as U,k as Y,j as Z,p as Ie,E as Be,_ as Me,n as Oe}from"../chunks/scheduler.f417f79b.js";import{S as fe,i as de,b as C,d as S,m as E,a as I,t as B,e as M,h as Te}from"../chunks/index.8ede18d1.js";import{S as De}from"../chunks/phoenix.4c184a8e.js";import{B as F}from"../chunks/Button.6dee57fd.js";import{t as re,g as me,a as je}from"../chunks/Indicator.svelte_svelte_type_style_lang.7922a51a.js";import{I as Pe,L as ce}from"../chunks/Input.2343a75c.js";import{T as Ve,a as Ne}from"../chunks/Tabs.90c08209.js";function Ue(o){let e,a,t,l=[{type:"file"},o[17]],s={};for(let r=0;r<l.length;r+=1)s=Q(s,l[r]);return{c(){e=R("input"),this.h()},l(r){e=A(r,"INPUT",{type:!0}),this.h()},h(){le(e,s)},m(r,m){v(r,e,m),e.autofocus&&e.focus(),a||(t=[b(e,"change",o[5]),b(e,"keyup",o[6]),b(e,"keydown",o[7]),b(e,"keypress",o[8]),b(e,"focus",o[9]),b(e,"blur",o[10]),b(e,"click",o[11]),b(e,"mouseover",o[12]),b(e,"mouseenter",o[13]),b(e,"mouseleave",o[14]),b(e,"paste",o[15]),b(e,"change",o[16])],a=!0)},p(r,m){le(e,s=me(l,[{type:"file"},m&131072&&r[17]]))},d(r){r&&g(e),a=!1,Ce(t)}}}function Le(o){let e,a;const t=[o[3],{class:re(o[2],o[4].class)}];let l={$$slots:{default:[Ue,({props:s})=>({17:s}),({props:s})=>s?131072:0]},$$scope:{ctx:o}};for(let s=0;s<t.length;s+=1)l=Q(l,t[s]);return e=new Pe({props:l}),{c(){C(e.$$.fragment)},l(s){S(e.$$.fragment,s)},m(s,r){E(e,s,r),a=!0},p(s,[r]){const m=r&28?me(t,[r&8&&je(s[3]),r&20&&{class:re(s[2],s[4].class)}]):{};r&393219&&(m.$$scope={dirty:r,ctx:s}),e.$set(m)},i(s){a||(I(e.$$.fragment,s),a=!0)},o(s){B(e.$$.fragment,s),a=!1},d(s){M(e,s)}}}function Re(o,e,a){const t=["value","files","inputClass"];let l=oe(e,t),{value:s=""}=e,{files:r=void 0}=e,{inputClass:m="border !p-0 dark:text-gray-400"}=e;function _(d){y.call(this,o,d)}function c(d){y.call(this,o,d)}function i(d){y.call(this,o,d)}function $(d){y.call(this,o,d)}function u(d){y.call(this,o,d)}function n(d){y.call(this,o,d)}function p(d){y.call(this,o,d)}function O(d){y.call(this,o,d)}function j(d){y.call(this,o,d)}function P(d){y.call(this,o,d)}function V(d){y.call(this,o,d)}function z(){s=this.value,r=this.files,a(0,s),a(1,r)}return o.$$set=d=>{a(4,e=Q(Q({},e),se(d))),a(3,l=oe(e,t)),"value"in d&&a(0,s=d.value),"files"in d&&a(1,r=d.files),"inputClass"in d&&a(2,m=d.inputClass)},e=se(e),[s,r,m,l,e,_,c,i,$,u,n,p,O,j,P,V,z]}class Ae extends fe{constructor(e){super(),de(this,e,Re,Le,ue,{value:0,files:1,inputClass:2})}}async function Fe(){return console.log(ae),{endpoint:ae}}const rt=Object.freeze(Object.defineProperty({__proto__:null,load:Fe},Symbol.toStringTag,{value:"Module"}));function ze(o){let e,a="Upload file",t,l,s,r;function m(c){o[7](c)}let _={id:"videoInput"};return o[0]!==void 0&&(_.value=o[0]),l=new Ae({props:_}),Ie.push(()=>Te(l,"value",m)),{c(){e=R("span"),e.textContent=a,t=T(),C(l.$$.fragment)},l(c){e=A(c,"SPAN",{"data-svelte-h":!0}),Be(e)!=="svelte-ann0ip"&&(e.textContent=a),t=D(c),S(l.$$.fragment,c)},m(c,i){v(c,e,i),v(c,t,i),E(l,c,i),r=!0},p(c,i){const $={};!s&&i[0]&1&&(s=!0,$.value=c[0],Me(()=>s=!1)),l.$set($)},i(c){r||(I(l.$$.fragment,c),r=!0)},o(c){B(l.$$.fragment,c),r=!1},d(c){c&&(g(e),g(t)),M(l,c)}}}function Je(o){let e,a;return{c(){e=N("File: "),a=N(o[0])},l(t){e=U(t,"File: "),a=U(t,o[0])},m(t,l){v(t,e,l),v(t,a,l)},p(t,l){l[0]&1&&Oe(a,t[0])},d(t){t&&(g(e),g(a))}}}function Ge(o){let e;return{c(){e=N("Play")},l(a){e=U(a,"Play")},m(a,t){v(a,e,t)},d(a){a&&g(e)}}}function He(o){let e,a,t,l,s,r,m,_,c,i,$,u;return m=new ce({props:{class:"space-y-2 mb-2",$$slots:{default:[ze]},$$scope:{ctx:o}}}),c=new ce({props:{$$slots:{default:[Je]},$$scope:{ctx:o}}}),$=new F({props:{$$slots:{default:[Ge]},$$scope:{ctx:o}}}),$.$on("click",o[8]),{c(){e=R("video"),a=T(),t=R("video"),l=T(),s=R("video"),r=T(),C(m.$$.fragment),_=T(),C(c.$$.fragment),i=T(),C($.$$.fragment),this.h()},l(n){e=A(n,"VIDEO",{style:!0,id:!0}),K(e).forEach(g),a=D(n),t=A(n,"VIDEO",{style:!0,id:!0}),K(t).forEach(g),l=D(n),s=A(n,"VIDEO",{style:!0,id:!0}),K(s).forEach(g),r=D(n),S(m.$$.fragment,n),_=D(n),S(c.$$.fragment,n),i=D(n),S($.$$.fragment,n),this.h()},h(){Y(e,"width","100%"),Z(e,"id","remote-stream"),e.controls=!0,e.autoplay=!0,Y(t,"width","100%"),Z(t,"id","local-stream"),t.autoplay=!0,t.muted=!0,Y(s,"width","100%"),Z(s,"id","localMusicVideo"),s.controls=!0,s.autoplay=!0},m(n,p){v(n,e,p),v(n,a,p),v(n,t,p),v(n,l,p),v(n,s,p),v(n,r,p),E(m,n,p),v(n,_,p),E(c,n,p),v(n,i,p),E($,n,p),u=!0},p(n,p){const O={};p[0]&1|p[1]&4&&(O.$$scope={dirty:p,ctx:n}),m.$set(O);const j={};p[0]&1|p[1]&4&&(j.$$scope={dirty:p,ctx:n}),c.$set(j);const P={};p[1]&4&&(P.$$scope={dirty:p,ctx:n}),$.$set(P)},i(n){u||(I(m.$$.fragment,n),I(c.$$.fragment,n),I($.$$.fragment,n),u=!0)},o(n){B(m.$$.fragment,n),B(c.$$.fragment,n),B($.$$.fragment,n),u=!1},d(n){n&&(g(e),g(a),g(t),g(l),g(s),g(r),g(_),g(i)),M(m,n),M(c,n),M($,n)}}}function qe(o){let e,a;return e=new Ne({props:{open:!0,title:"Remote",$$slots:{default:[He]},$$scope:{ctx:o}}}),{c(){C(e.$$.fragment)},l(t){S(e.$$.fragment,t)},m(t,l){E(e,t,l),a=!0},p(t,l){const s={};l[0]&1|l[1]&4&&(s.$$scope={dirty:l,ctx:t}),e.$set(s)},i(t){a||(I(e.$$.fragment,t),a=!0)},o(t){B(e.$$.fragment,t),a=!1},d(t){M(e,t)}}}function Ke(o){let e;return{c(){e=N("Guest Connect")},l(a){e=U(a,"Guest Connect")},m(a,t){v(a,e,t)},d(a){a&&g(e)}}}function Qe(o){let e;return{c(){e=N("Call")},l(a){e=U(a,"Call")},m(a,t){v(a,e,t)},d(a){a&&g(e)}}}function We(o){let e;return{c(){e=N("Connect")},l(a){e=U(a,"Connect")},m(a,t){v(a,e,t)},d(a){a&&g(e)}}}function Xe(o){let e;return{c(){e=N("Disconnect")},l(a){e=U(a,"Disconnect")},m(a,t){v(a,e,t)},d(a){a&&g(e)}}}function Ye(o){let e,a,t,l,s,r,m,_,c,i,$;return e=new Ve({props:{$$slots:{default:[qe]},$$scope:{ctx:o}}}),l=new F({props:{$$slots:{default:[Ke]},$$scope:{ctx:o}}}),l.$on("click",o[9]),r=new F({props:{$$slots:{default:[Qe]},$$scope:{ctx:o}}}),r.$on("click",o[10]),_=new F({props:{$$slots:{default:[We]},$$scope:{ctx:o}}}),_.$on("click",o[11]),i=new F({props:{$$slots:{default:[Xe]},$$scope:{ctx:o}}}),i.$on("click",o[12]),{c(){C(e.$$.fragment),a=T(),t=R("section"),C(l.$$.fragment),s=T(),C(r.$$.fragment),m=T(),C(_.$$.fragment),c=T(),C(i.$$.fragment)},l(u){S(e.$$.fragment,u),a=D(u),t=A(u,"SECTION",{});var n=K(t);S(l.$$.fragment,n),s=D(n),S(r.$$.fragment,n),m=D(n),S(_.$$.fragment,n),c=D(n),S(i.$$.fragment,n),n.forEach(g)},m(u,n){E(e,u,n),v(u,a,n),v(u,t,n),E(l,t,null),X(t,s),E(r,t,null),X(t,m),E(_,t,null),X(t,c),E(i,t,null),$=!0},p(u,n){const p={};n[0]&1|n[1]&4&&(p.$$scope={dirty:n,ctx:u}),e.$set(p);const O={};n[1]&4&&(O.$$scope={dirty:n,ctx:u}),l.$set(O);const j={};n[1]&4&&(j.$$scope={dirty:n,ctx:u}),r.$set(j);const P={};n[1]&4&&(P.$$scope={dirty:n,ctx:u}),_.$set(P);const V={};n[1]&4&&(V.$$scope={dirty:n,ctx:u}),i.$set(V)},i(u){$||(I(e.$$.fragment,u),I(l.$$.fragment,u),I(r.$$.fragment,u),I(_.$$.fragment,u),I(i.$$.fragment,u),$=!0)},o(u){B(e.$$.fragment,u),B(l.$$.fragment,u),B(r.$$.fragment,u),B(_.$$.fragment,u),B(i.$$.fragment,u),$=!1},d(u){u&&(g(a),g(t)),M(e,u),M(l),M(r),M(_),M(i)}}}function H(){console.log(...arguments)}function q(o,e){o.srcObject=e}function ie(o){o.srcObject&&o.srcObject.getTracks().forEach(e=>e.stop()),o.removeAttribute("src"),o.removeAttribute("srcObject")}function Ze(o,e,a){let{data:t}=e,l,s,r=document.getElementById("videoInput"),m=document.getElementById("localMusicVideo"),_,c,i,$=new MediaStream,u="localhost:8512",n;async function p(){if(r=document.getElementById("videoInput"),m=document.getElementById("localMusicVideo"),r.files.length===0){console.error("No video selected.");return}const f=r.files[0],h=new Blob([f],{type:f.type});let L=1;try{n=new MediaSource,m.src=window.URL.createObjectURL(n),n.addEventListener("sourceopen",function(){var k=n.addSourceBuffer('video/webm; codecs="vorbis,vp8"'),w=Math.ceil(h.size/L),W=0;(function ke(G){var te=new FileReader;te.onload=function(ye){k.appendBuffer(new Uint8Array(ye.target.result)),H("Appending chunk: "+G),G===L-1?k.addEventListener("updateend",function(){!k.updating&&n.readyState==="open"&&n.endOfStream()}):(m.paused&&m.play(),ke(++G))};var ne=w*G,we=h.slice(ne,ne+w);te.readAsArrayBuffer(we)})(W)},!1)}catch(k){console.error("Error playing video:",k)}}function O(f){let h=new RTCPeerConnection({iceServers:[{urls:["stun:localhost:3487"]}]});return h.ontrack=j,h.onicecandidate=P,f.getTracks().forEach(L=>h.addTrack(L)),h}function j(f){console.log("track on..."),$.addTrack(f.track)}function P(f){f.candidate&&J("ice-candidate",f.candidate)}async function V(){var f=document.getElementById("localMusicVideo"),h=f.mozCaptureStream();q(_,h),i=O(h)}async function z(){_=document.getElementById("local-stream"),c=document.getElementById("remote-stream");var f=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0});q(_,f),i=O(f)}function d(){i!=null&&(ie(_),ie(c),$=new MediaStream,q(c,$),i.close(),i=null,J("disconnect",{}))}async function x(){i!=null?await i.createOffer().then(f=>{console.log("offered!"),i.setLocalDescription(f),J("video-offer",f)}):console.log("Camera not setup yet!")}function J(f,h){l.push("peer-message",{body:JSON.stringify({type:f,content:h})})}function ee(f){if(console.log("receive remote"),f!=null&&i!=null){let h=new RTCSessionDescription(f);console.log("set remote desci"),i.setRemoteDescription(h)}}async function pe(f){if(f!=null){ee(f);let h=await i.createAnswer();i.setLocalDescription(h).then(()=>J("video-answer",i.localDescription))}}Se(()=>{_=document.getElementById("local-stream"),c=document.getElementById("remote-stream"),$=new MediaStream,q(c,$),console.log(t),u=t.endpoint;const f=new De("ws://"+u+"/socket");f.connect();var h="support:lobby";l=f.channel(h,{}),l.join().receive("ok",k=>{console.log("Joined topic",h)}).receive("error",k=>{console.log("Unable to join topic",h)}),l.on("peer-message",k=>{var w=JSON.parse(k.body);switch(w.type){case"video-offer":H("offered: ",w.content),pe(w.content);break;case"video-answer":H("answered: ",w.content),ee(w.content);break;case"ice-candidate":H("candidate: ",w.content);let W=new RTCIceCandidate(w.content);i!=null&&i.addIceCandidate(W).catch(reportError);break;case"disconnect":d();break;default:reportError("unhandled message type")(w.type)}});var L=f.channel(h+"_screen",{});L.join().receive("ok",k=>{console.log("Joined topic",h+"_screen")}).receive("error",k=>{console.log("Unable to join topic",h+"_screen")})}),Ee(()=>{l&&l.leave().receive("ok",f=>{console.log("Left the channel",f)}).receive("error",f=>{console.log("Error leaving the channel",f)})});function _e(f){s=f,a(0,s)}const $e=()=>{p()},ge=()=>{V()},he=()=>{x()},ve=()=>{z()},be=()=>{d()};return o.$$set=f=>{"data"in f&&a(6,t=f.data)},[s,p,V,z,d,x,t,_e,$e,ge,he,ve,be]}class ct extends fe{constructor(e){super(),de(this,e,Ze,Ye,ue,{data:6},null,[-1,-1])}}export{ct as component,rt as universal};
